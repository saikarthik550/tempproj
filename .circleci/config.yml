version: 2.1

jobs:
  cleanup:
    docker:
  
      - image: python:3.11.0-alpine3.16
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            # your code here
            apk add --update --no-cache tar gzip nodejs npm curl
            pip install awscli
      - run:
          name: store old workflowid  
          command: |
            # your code here
            cat OldWorkflowID.txt  
            aws cloudformation list-exports \
              --query "Exports[?Name==\`WorkflowID\`].Value" \
              --no-paginate \
              --output text >> OldWorkflowID.txt
            cat -n OldWorkflowID.txt  
      - run:
          name: Remove old stacks and files
          command: |
            export OldWorkflowID="   http://${BACKEND_IP}:3030"
            echo "oldwork:" $OldWorkflowID  
            echo $OldWorkflowID
            $OldWorkflowID='echo $OldWorkflowID | sed -e 's/^[[:space:]]*//''
            
              aws s3 rm "s3://udapeople-${OldWorkflowID( )}" --recursive || true
workflows:           
  default:
    jobs:
      - cleanup
         
